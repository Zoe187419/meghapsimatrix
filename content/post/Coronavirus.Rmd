---
title: "Coronavirus"
author: "Megha Joshi"
date: 2020-03-27
categories: ["R"]
tags: ["coronavirus", "COVID-19", "gganimate", "ggplot", "leaflet"]

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this post, I am analyzing data on COVID-19 cases worldwide. 

# Libraries

```{r message = FALSE, warning = FALSE}
library(tidyverse)
library(maps)
library(ggthemes)
library(jsonlite)
library(leaflet)
library(widgetframe)
library(lubridate)
library(scales)
```


# Read in the Data

I downloaded the data from [DataHub](https://datahub.io/core/covid-19).

```{r, message = F, warning = F}
json_file <- 'https://datahub.io/core/covid-19/datapackage.json'
json_data <- fromJSON(paste(readLines(json_file), collapse = ""))

# get list of all resources:
# print(json_data$resources$name)

path_to_file <- json_data$resources$path[2]
dat <- read_csv(url(path_to_file))

dat <- dat %>%
  filter(Confirmed != 0) %>%
  mutate(lab = paste0("Confirmed: ", Confirmed, " ,", "Deaths: ", Deaths)) %>%
  rename(Country = `Country/Region`)

date <- tibble(Date = unique(dat$Date)) %>%
  arrange(Date) %>%
  mutate(days = row_number())

dat <- dat %>%
  left_join(date, by = "Date")

```


# Coronavirus Confirmed Cases

```{r}
covid_leaf <- leaflet(data = dat, options = leafletOptions(minZoom = 1.5)) %>% 
  addProviderTiles(providers$CartoDB.DarkMatter)  %>%
  addCircleMarkers(~Long, ~Lat, radius = ~Confirmed/1000, label = ~lab, fillOpacity = .2)

frameWidget(covid_leaf)
```


# Cases by Week

## Confirmed 

```{r, fig.width=8, fig.height=6}
country_dat <- dat %>%
  filter(Country %in% c("China", "Italy", "Korea, South", "US")) %>%
  mutate(week = cut(Date, "week", start.on.monday = FALSE))

country_dat %>%
  ggplot(aes(x = Confirmed, y = week)) +
  geom_bar(stat = "identity", position = "dodge", fill = "blue4") + 
  facet_wrap(~ Country) +
  labs(y = "", x = "Confirmed Cases") + 
  scale_x_continuous(labels = comma) +
  theme_bw()
```

## Deaths

```{r, fig.width=8, fig.height=6}
country_dat %>%
  ggplot(aes(x = Deaths, y = week)) +
  geom_bar(stat = "identity", position = "dodge", fill = "red4") + 
  facet_wrap(~ Country) +
  labs(y = "") + 
  scale_x_continuous(labels = comma) +
  theme_bw()
```

# Confirmed Cases by Days

```{r}
country_dat %>%
  group_by(days, Country) %>%
  summarize(Confirmed = sum(Confirmed)) %>%
  ungroup() %>%
  ggplot(aes(x = days, y = Confirmed, color = Country)) +
  geom_line(size = 1) +
  scale_y_continuous(labels = comma) +
  scale_color_brewer(type = "qual", palette = 6) + 
  labs(x = "Days", y = "Confirmed Cases") + 
  theme_bw()
```

