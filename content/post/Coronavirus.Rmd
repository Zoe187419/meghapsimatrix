---
title: "COVID-19"
author: "Megha Joshi"
date: 2020-04-27
categories: ["R"]
tags: ["coronavirus", "COVID-19", "ggplot", "leaflet"]

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this post, I am analyzing data on COVID-19 cases worldwide. The data that I am analyzing only accounts for reported cases. Due to the lack of availability and accessibility of testing in countries like the US, the numbers may be an underestimate of the actual number of cases, number of deaths, and number of recoveries. The data does not account for any other errors of measurement. 

# Libraries

```{r message = FALSE, warning = FALSE}
library(tidyverse)
library(lubridate)
library(leaflet)
library(widgetframe)
library(scales)
```


# Read in the Data

I downloaded the data from [here](https://github.com/CSSEGISandData/COVID-19).

```{r, warning = FALSE, message = FALSE}
confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv") %>%
  pivot_longer(cols = -c(1:4),
               names_to = "date",
               values_to = "confirmed")

deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv") %>%
  pivot_longer(cols = -c(1:4),
               names_to = "date",
               values_to = "deaths")

recovered <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv") %>%
  pivot_longer(cols = -c(1:4),
               names_to = "date",
               values_to = "recoveries")

# Join and Clean 
dat <- left_join(confirmed, deaths) %>%
  left_join(recovered) %>%
  mutate(date = mdy(date),
         lab = paste0("Confirmed: ", confirmed, ", ", "Deaths: ", deaths, ", ", "Recovered: ", recoveries)) %>%
  rename(country_region = `Country/Region`)
```


# Coronavirus Confirmed Cases

```{r}
covid_leaf <- leaflet(data = dat, 
                      options = leafletOptions(minZoom = 1.5)) %>% 
  addProviderTiles(providers$CartoDB.DarkMatter)  %>%
  addCircleMarkers(~Long, ~Lat, 
                   radius = ~confirmed/10000, 
                   label = ~lab, 
                   fillOpacity = .2)

frameWidget(covid_leaf)
```


# Cases by Week

## Confirmed 

```{r, fig.width=11, fig.height=9}
country_dat <- dat %>%
  filter(country_region %in% c("China", "Italy", "Iran", "Korea, South", "Spain", "US")) %>%
  mutate(week = cut(date, "week", start.on.monday = FALSE))

country_dat %>%
  ggplot(aes(x = confirmed/1000, y = week)) +
  geom_bar(stat = "identity", position = "dodge", fill = "blue4") + 
  facet_wrap(~ country_region) +
  labs(y = "", x = "Confirmed Cases (in thousands)") + 
  scale_x_continuous(labels = comma) +
  theme_bw() +
  theme(legend.position = "none")
```

## Deaths

```{r, fig.width=11, fig.height=9}
country_dat %>%
  ggplot(aes(x = deaths/1000, y = week)) +
  geom_bar(stat = "identity", position = "dodge", fill = "red4") + 
  facet_wrap(~ country_region) +
  labs(y = "", x = "Deaths (in thousands)") + 
  scale_x_continuous(labels = comma) +
  theme_bw() +
  theme(legend.position = "none")
```

## Recoveries

```{r, fig.width=11, fig.height=9}
country_dat %>%
  ggplot(aes(x = recoveries/1000, y = week)) +
  geom_bar(stat = "identity", position = "dodge", fill = "green4") + 
  facet_wrap(~ country_region) +
  labs(y = "", x = "Recovered (in thousands)") + 
  scale_x_continuous(labels = comma) +
  theme_bw() +
  theme(legend.position = "none")
```

# Confirmed Cases Trend

```{r, fig.height = 5, fig.width = 8}
sum_dat <- country_dat %>%
  group_by(date, country_region) %>%
  summarize(confirmed = sum(confirmed)) %>%
  ungroup() %>%
  mutate(country_region = if_else(country_region == "Korea, South", "S. Korea", country_region))
  
sum_dat %>%  
  ggplot(aes(x = date, y = confirmed, color = country_region)) +
  geom_line(size = .8) +
  geom_text(data = sum_dat %>% filter(date == last(date)), 
            aes(label = country_region, x = date + .1, 
                y = confirmed, color = country_region), 
            hjust = -.01) +
  scale_y_continuous(labels = comma, breaks = seq(0, 1000000, 100000)) +
  xlim(ymd("2020-01-22"), ymd("2020-04-30")) + 
  scale_color_brewer(type = "qual", palette = 2) + 
  labs(x = "", y = "Confirmed Cases", color = "Country") + 
  ggtitle("Confirmed Cases as of April 27, 2020") +
  theme_bw() +
  theme(legend.position = "none")
  
```






