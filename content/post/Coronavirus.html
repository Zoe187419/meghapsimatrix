---
title: "Coronavirus"
author: "Megha Joshi"
date: 2020-03-23
categories: ["R"]
tags: ["coronavirus", "COVID-19", "gganimate", "ggplot", "leaflet"]

---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/pymjs/pym.v1.js"></script>
<script src="/rmarkdown-libs/widgetframe-binding/widgetframe.js"></script>


<div id="libraries" class="section level1">
<h1>Libraries</h1>
<pre class="r"><code>library(tidyverse)
library(maps)
library(ggthemes)
library(jsonlite)
library(leaflet)
library(widgetframe)
library(lubridate)
library(gganimate)</code></pre>
</div>
<div id="read-in-the-data" class="section level1">
<h1>Read in the data</h1>
<p>I downloaded the data from <a href="https://datahub.io/core/covid-19">DataHub</a>.</p>
<pre class="r"><code>json_file &lt;- &#39;https://datahub.io/core/covid-19/datapackage.json&#39;
json_data &lt;- fromJSON(paste(readLines(json_file), collapse=&quot;&quot;))

# get list of all resources:
# print(json_data$resources$name)

path_to_file = json_data$resources$path[2]
dat &lt;- read_csv(url(path_to_file))

dat &lt;- dat %&gt;%
  filter(Confirmed != 0)</code></pre>
</div>
<div id="coronavirus-leaflet" class="section level1">
<h1>Coronavirus Leaflet</h1>
<pre class="r"><code>covid_leaf &lt;- leaflet(data = dat, options = leafletOptions(minZoom = 1.5)) %&gt;% 
  addProviderTiles(providers$CartoDB.DarkMatter)  %&gt;%
  addCircleMarkers(~Long, ~Lat, radius = ~Confirmed/1000, label = ~Confirmed, fillOpacity = .2)

frameWidget(covid_leaf)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"/post/Coronavirus_files/figure-html//widgets/widget_unnamed-chunk-3.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="map-of-confirmed-cases" class="section level1">
<h1>Map of Confirmed Cases</h1>
<pre class="r"><code>world &lt;- map_data(&#39;world&#39;) %&gt;% fortify

world_mp &lt;- ggplot() +
  borders(&quot;world&quot;, colour = &quot;gray30&quot;, fill = &quot;gray24&quot;) +
  theme_map() 

covid_map &lt;- world_mp +
  geom_point(aes(x = Long, y = Lat, size = Confirmed),
             data = dat, 
             colour = &#39;blue&#39;, alpha = .6) +
  labs(size = &#39;Cases&#39;) +
  theme(legend.position = &quot;none&quot;)

covid_map</code></pre>
<p><img src="/post/Coronavirus_files/figure-html/unnamed-chunk-4-1.png" width="960" /></p>
</div>
<div id="animation-of-confirmed-cases" class="section level1">
<h1>Animation of Confirmed Cases</h1>
<pre class="r"><code>covid_animate &lt;- covid_map +
  transition_states(Date) +
  labs(title = &#39;Date: {closest_state}&#39;) 

animate(covid_animate)</code></pre>
<p><img src="/post/Coronavirus_files/figure-html/unnamed-chunk-5-1.gif" /><!-- --></p>
</div>
<div id="cases-by-week" class="section level1">
<h1>Cases by Week</h1>
<div id="confirmed" class="section level2">
<h2>Confirmed</h2>
<pre class="r"><code>country_dat &lt;- dat %&gt;%
  filter(`Country/Region` %in% c(&quot;China&quot;, &quot;Italy&quot;, &quot;Korea, South&quot;, &quot;US&quot;)) %&gt;%
  rename(Country = `Country/Region`) %&gt;%
  mutate(week = cut(Date, &quot;week&quot;, start.on.monday = FALSE))

country_dat %&gt;%
  ggplot(aes(x = Confirmed, y = week)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;, fill = &quot;blue4&quot;) + 
  facet_wrap(~ Country) +
  labs(y = &quot;&quot;) + 
  theme_bw()</code></pre>
<p><img src="/post/Coronavirus_files/figure-html/unnamed-chunk-6-1.png" width="768" /></p>
</div>
<div id="deaths" class="section level2">
<h2>Deaths</h2>
<pre class="r"><code>country_dat %&gt;%
  ggplot(aes(x = Deaths, y = week)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;, fill = &quot;red4&quot;) + 
  facet_wrap(~ Country) +
  labs(y = &quot;&quot;) + 
  theme_bw()</code></pre>
<p><img src="/post/Coronavirus_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
</div>
<div id="recovered" class="section level2">
<h2>Recovered</h2>
<pre class="r"><code>country_dat %&gt;%
  ggplot(aes(x = Recovered, y = week)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;, fill = &quot;green4&quot;) + 
  facet_wrap(~ Country) +
  labs(y = &quot;&quot;) + 
  theme_bw()</code></pre>
<p><img src="/post/Coronavirus_files/figure-html/unnamed-chunk-8-1.png" width="768" /></p>
</div>
</div>
