---
title: "COVID-19"
author: "Megha Joshi"
date: 2020-05-01
categories: ["R"]
tags: ["coronavirus", "COVID-19", "ggplot", "leaflet"]

---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/pymjs/pym.v1.js"></script>
<script src="/rmarkdown-libs/widgetframe-binding/widgetframe.js"></script>


<p>In this post, I am analyzing data on COVID-19 cases worldwide. The data that I am analyzing only accounts for reported cases. Due to the lack of availability and accessibility of testing in countries like the US, the numbers may be an underestimate of the actual number of cases, number of deaths, and number of recoveries. The data does not account for any other errors of measurement.</p>
<div id="libraries" class="section level1">
<h1>Libraries</h1>
<pre class="r"><code>library(tidyverse)
library(lubridate)
library(leaflet)
library(widgetframe)
library(scales)</code></pre>
</div>
<div id="read-in-the-data" class="section level1">
<h1>Read in the Data</h1>
<p>I downloaded the data from <a href="https://github.com/CSSEGISandData/COVID-19">here</a>.</p>
<pre class="r"><code>confirmed &lt;- read_csv(&quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv&quot;) %&gt;%
  pivot_longer(cols = -c(1:4),
               names_to = &quot;date&quot;,
               values_to = &quot;confirmed&quot;)

deaths &lt;- read_csv(&quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv&quot;) %&gt;%
  pivot_longer(cols = -c(1:4),
               names_to = &quot;date&quot;,
               values_to = &quot;deaths&quot;)

recovered &lt;- read_csv(&quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv&quot;) %&gt;%
  pivot_longer(cols = -c(1:4),
               names_to = &quot;date&quot;,
               values_to = &quot;recoveries&quot;)

# Join and Clean 
dat &lt;- left_join(confirmed, deaths) %&gt;%
  left_join(recovered) %&gt;%
  mutate(date = mdy(date),
         lab = paste0(&quot;Confirmed: &quot;, confirmed, &quot;, &quot;, &quot;Deaths: &quot;, deaths, &quot;, &quot;, &quot;Recovered: &quot;, recoveries)) %&gt;%
  rename(country_region = `Country/Region`)</code></pre>
</div>
<div id="coronavirus-confirmed-cases" class="section level1">
<h1>Coronavirus Confirmed Cases</h1>
<pre class="r"><code>covid_leaf &lt;- leaflet(data = dat, 
                      options = leafletOptions(minZoom = 1.5)) %&gt;% 
  addProviderTiles(providers$CartoDB.DarkMatter)  %&gt;%
  addCircleMarkers(~Long, ~Lat, 
                   radius = ~confirmed/10000, 
                   label = ~lab, 
                   fillOpacity = .2)

frameWidget(covid_leaf)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"/post/Coronavirus_files/figure-html//widgets/widget_unnamed-chunk-3.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="cases-by-week" class="section level1">
<h1>Cases by Week</h1>
<div id="confirmed" class="section level2">
<h2>Confirmed</h2>
<pre class="r"><code>country_dat &lt;- dat %&gt;%
  filter(country_region %in% c(&quot;China&quot;, &quot;Italy&quot;, &quot;Iran&quot;, &quot;Korea, South&quot;, &quot;Spain&quot;, &quot;US&quot;)) %&gt;%
  mutate(week = cut(date, &quot;week&quot;, start.on.monday = FALSE))

country_dat %&gt;%
  ggplot(aes(x = confirmed/1000000, y = week)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;, fill = &quot;blue4&quot;) + 
  facet_wrap(~ country_region) +
  labs(y = &quot;&quot;, x = &quot;Confirmed Cases (in millions)&quot;) + 
  scale_x_continuous(labels = comma) +
  theme_bw() +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/Coronavirus_files/figure-html/unnamed-chunk-4-1.png" width="1056" /></p>
</div>
<div id="deaths" class="section level2">
<h2>Deaths</h2>
<pre class="r"><code>country_dat %&gt;%
  ggplot(aes(x = deaths/1000, y = week)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;, fill = &quot;red4&quot;) + 
  facet_wrap(~ country_region) +
  labs(y = &quot;&quot;, x = &quot;Deaths (in thousands)&quot;) + 
  scale_x_continuous(labels = comma) +
  theme_bw() +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/Coronavirus_files/figure-html/unnamed-chunk-5-1.png" width="1056" /></p>
</div>
<div id="recoveries" class="section level2">
<h2>Recoveries</h2>
<pre class="r"><code>country_dat %&gt;%
  ggplot(aes(x = recoveries/1000, y = week)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;, fill = &quot;green4&quot;) + 
  facet_wrap(~ country_region) +
  labs(y = &quot;&quot;, x = &quot;Recovered (in thousands)&quot;) + 
  scale_x_continuous(labels = comma) +
  theme_bw() +
  theme(legend.position = &quot;none&quot;)</code></pre>
<pre><code>## Warning: Removed 404 rows containing missing values (geom_bar).</code></pre>
<p><img src="/post/Coronavirus_files/figure-html/unnamed-chunk-6-1.png" width="1056" /></p>
</div>
</div>
<div id="confirmed-cases-trend" class="section level1">
<h1>Confirmed Cases Trend</h1>
<pre class="r"><code>sum_dat &lt;- country_dat %&gt;%
  group_by(date, country_region) %&gt;%
  summarize(confirmed = sum(confirmed)) %&gt;%
  ungroup() %&gt;%
  mutate(country_region = if_else(country_region == &quot;Korea, South&quot;, &quot;S. Korea&quot;, country_region))
  
sum_dat %&gt;%  
  ggplot(aes(x = date, y = confirmed, color = country_region)) +
  geom_line(size = .8) +
  geom_text(data = sum_dat %&gt;% filter(date == last(date)), 
            aes(label = country_region, x = date + .1, 
                y = confirmed, color = country_region), 
            hjust = -.01) +
  scale_y_continuous(labels = comma, breaks = seq(0, 2000000, 100000)) +
  xlim(ymd(&quot;2020-01-22&quot;), ymd(&quot;2020-05-06&quot;)) + 
  scale_color_brewer(type = &quot;qual&quot;, palette = 2) + 
  labs(x = &quot;&quot;, y = &quot;Confirmed Cases&quot;, color = &quot;Country&quot;) + 
  ggtitle(&quot;Confirmed Cases as of AMay 1, 2020&quot;) +
  theme_bw() +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/Coronavirus_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
</div>
